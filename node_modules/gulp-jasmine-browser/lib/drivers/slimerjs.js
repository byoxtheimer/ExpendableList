//(c) Copyright 2015 Pivotal Software, Inc. All Rights Reserved.
'use strict';

var _promise = require('babel-runtime/core-js/promise');

var _promise2 = _interopRequireDefault(_promise);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var es = require('event-stream');
module.exports = function () {
  return {
    get command() {
      try {
        return require('slimerjs').path;
      } catch (e) {
        return 'slimerjs';
      }
    },
    runner: 'slimer_runner.js',
    run: function run(phantomProcess) {
      return new _promise2.default(function (resolve, reject) {
        phantomProcess.stdout.pipe(es.wait(function (err, body) {
          if (err) return reject(err);

          var _JSON$parse = JSON.parse(body);

          var success = _JSON$parse.success;
          var buffer = _JSON$parse.buffer;

          console.log(buffer);
          if (!success) return reject(success);
          resolve(success);
        }));
      });
    }
  };
};